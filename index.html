<!DOCTYPE html>
<html>
	<head>
		<title>Desktop - INeedAUniqueUsername Simulator</title>
        <link rel="stylesheet" type="text/css" href="index.css">
		<style>
            #commander {
                width: 100%;
                display: flex;
            }
            #dir {
                background-color: rgb(20, 20, 40);
            }
            #input {
                flex: 100 0 auto;
                border: none;
                color: rgb(225, 255, 225);
                background-color: rgb(20, 20, 40);
                caret-color: rgb(225, 255, 225);
            }
            
        </style>
	</head>
	<body>
		<p class="title"><b>INeedAUniqueUsername Simulator</b></p>
        <p class="standard" id="console">
        </p>
        <div id="commander">
            <p id="dir" class="standard"></p>
            <input type="text" class="standard input" onkeydown="Pressed(this)" autofocus="true" id="input">
                <script type="text/javascript">
                    function Pressed() {
                        let input = document.getElementById("input")
                        if(event.key === "Enter") {
                            Handle(input.value)
                            UpdateLines();
                            input.value = "";
                            scrollIndex = Math.max(0, lines.length - lineCount);
                        }
                    }

                    let path = ["C:", "Users", "Guest", "Desktop"]
                    let tree = {
                        "C:": {
                            "Users": {
                                "Guest": {
                                    "Desktop": {
                                        /*
                                        "DREAME.txt": () => document.location.href = document.location.href.substr(0, document.location.href.lastIndexOf('/'))+"/DREAME.txt",
                                        */
                                        "TorrentialRain.txt": () => {
                                            document.location.href = "TorrentialRain.html"
                                        },
                                        "DREAME.txt": () => {
                                            document.location.href = "DREAME.html"
                                        },
                                        source: {
                                            "Transgenesis.txt": () => {}
                                        },
                                        RainAndLightning: {
                                            
                                        },
                                        "Unit17Games.pdf": () => {
                                            document.location.href = "Unit17Games.html"
                                        }
                                    }
                                }
                            }
                        }
                    }
                    function GetPath() { return path.join('\\') + ">" }
                    function UpdatePath() {
                        document.getElementById("dir").innerHTML = GetPath();
                    }
                    UpdatePath()
                </script>
            </input>
        </div>
        <script type="text/javascript">
            let scrollIndex = 0;
            let lineCount = 24;
            let lines = [
                "INeedAUniqueUsername Simulator v1.0",
                "(C) INeedAUniqueUsername Machinations, 1998-2020"
            ];
            function UpdateLines() {
                let visible = lines.slice(scrollIndex, scrollIndex + lineCount)
                /*
                while(visible.length < lineCount) {
                    visible.push("");
                }
                */
                document.getElementById("console").innerHTML = visible.join("<br>");
            }
            UpdateLines()
            function GetCwd() {
                let cwd = tree
                path.forEach(dir => cwd = cwd[dir])
                return cwd;
            }
            let unhandled = 0
            function Handle(command) {
                let commands = {
                    cat: str => {
                        let cwd = GetCwd()
                        let sub = cwd[str]
                        if(sub && sub instanceof Function) {
                            sub()
                        } else {
                            lines.push("Unknown file: " + str)
                        }
                    },
                    cd: str => {
                        if(str === "..") {
                            if(path.length > 4) {
                                path.pop()
                            } else {
                                lines.push("Access denied")
                            }
                        } else {
                            let cwd = GetCwd()
                            let sub = cwd[str]
                            if(sub && sub instanceof Object && !(sub instanceof Function)) {
                                path.push(str);
                            } else {
                                lines.push("Unknown directory " + str)
                            }
                        }
                    },
                    ls: str => {
                        let line = ""
                        let items = Object.keys(GetCwd())
                        items.unshift("..")
                        items.forEach(sub => {
                            let str = sub.padEnd((1 + parseInt(sub.length / 16)) * 16)
                            
                            
                            if(line.length + str.length < 80) {
                                line += str
                            } else {
                                lines.push(line)
                                line = str
                            }
                        })
                        if(line.length > 0) {
                            lines.push(line)
                        }
                    },
                    help: str => {
                        lines.push(
                            "cat <filename>: View the contents of a file in the current working directory",
                            "cd <directory>: Change the current working directory",
                            "ls: List all files and subdirectories in the current working directory",
                            "help: View this help text",
                            "navigate: View direct links to all the pages on this website"
                        )
                    },
                    navigate: str => {
                        lines.push(
                            "All pages on this website:",
                            `<a href="TorrentialRain.html" class="standard" target="_blank">Torrential Rain (animated page)</a>`,
                            `<a href="Unit17Games.html" class="standard" target="_blank">Unid 17 Games (portfolio)</a>`
                        )
                    }
                }
                lines.push(GetPath() + command);
                let handled = false
                Object.keys(commands).forEach(c => {
                    if(command.startsWith(c)) {
                        command = command.substr(c.length + 1)
                        commands[c](command)
                        handled = true
                    }
                })
                if(handled) {
                    unhandled = 3
                } else {
                    
                    switch(unhandled) {
                        case 1:
                            commands["help"]()
                            break;
                        case 2:
                            commands["navigate"]()
                            break;
                            
                        case 0:
                        default:
                            let program = command.split(" ")[0]
                            lines.push("Unknown command: " + program,
                                        "Enter 'help' for a list of commands")
                            break;
                    }
                    unhandled++
                }
                UpdatePath()
                lines.push(" ")
            }
        </script>
	</body>
</html>